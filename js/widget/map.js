define("SensorWidget",["i18n","css!SensorWidgets.css"],function(e){"use strict";var t={},n=function(e){return function(){return"SensorWidgetTarget-"+ ++e}}(0);return function(i,r,o){function a(e,t,n){var i="";t&&(i="["+t+"] "),n&&n.request&&(i+=n.request+": "),e&&(i+=e),o.innerHTML='<div class="text-danger">'+i+"</div>"}function s(t,n,i){var r=[];for(var o in n){var s=n[o];i.hasOwnProperty(s)||r.push(s)}return r.length&&a(e.t("The '{name}' widget is missing some mandatory parameters: ",{name:t})+r.join(", ")),!r.length}return o||(o=document.body),i&&r?(o.id||(o.id=n()),r.service||(r.service="/52n-sos/sos/json"),require(["widget/"+i],function(e){o.innerHTML="",t.hasOwnProperty(o.id)&&t[o.id]&&t[o.id].hasOwnProperty("destroy")&&(console.debug("Destroying previous widget on ElementId="+o.id),t[o.id].destroy(),delete t[o.id]),s(i,e.inputs,r)&&(console.debug("Creating new "+i+" widget on ElementId="+o.id),t[o.id]=e.init(r,o,a))},function(){a(e.t("Widget '{name}' cannot be found",{name:i}))})):i||a(e.t("No widget name specified")),{name:i,config:r,renderTo:o,inspect:function(e){require(["widget/"+i],function(t){e.call(this,t.inputs,t.optional_inputs,t.preferredSizes)})},url:function(){function t(e){var t=[];return e.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){"/.."===e?t.pop():t.push(e)}),t.join("").replace(/^\//,"/"===e.charAt(0)?"/":"")}var n=t(require.toUrl("../widget/"))+"?";return n+="name="+encodeURIComponent(i)+"&",n+=Object.keys(r).map(function(e){var t=r[e];return"object"==typeof r[e]&&(t=JSON.stringify(r[e])),e+"="+encodeURIComponent(t)}).join("&"),n+="&lang="+e.getLang()},iframe:function(e,t){return e=e?e:"100%",t=t?t:"100%",'<iframe src="'+this.url()+'" width="'+e+'" height="'+t+'" frameBorder="0"></iframe>'},javascript:function(){return"SensorWidget('"+i+"', "+JSON.stringify(r,null,3)+", document.getElementById('"+i+"-container'));"}}}}),define("widget/map",["SOS","leaflet","SensorWidget","widget-common","leaflet-label","leaflet-cluster"],function(e,t,n,i){"use strict";return t.Label.prototype._updateContent=function(){if(this._content&&this._map&&this._prevContent!==this._content){if("string"==typeof this._content)this._container.innerHTML=this._content;else{for(;this._container.hasChildNodes();)this._container.removeChild(this._container.firstChild);this._container.appendChild(this._content)}this._prevContent=this._content,this._labelWidth=this._container.offsetWidth}},{inputs:i.inputs.concat(["features","properties"]),optional_inputs:["permanent_tooltips","popup_widget","no_clustering","swap_axis","max_initial_zoom","base_layer"].concat(i.optional_inputs),preferredSizes:[{w:550,h:400}],init:function(r,o,a){function s(){e.getCapabilities(function(i){function o(e){var i;r.no_clustering?i=m:(i=t.markerClusterGroup({showCoverageOnHover:!1,maxClusterRadius:50}),m.addLayer(i));var o=t.geoJson(c(e),{onEachFeature:function(e,t){var o=document.createElement("div");if(o.id="map-tooltip-"+e.id,o.appendChild(document.createTextNode(e.properties.name)),t.bindLabel(o,{noHide:!0}).addTo(i),r.properties&&"[]"!=r.properties&&r.properties.length&&new n("panel",{service:r.service,offering:r.offering,feature:e.id,properties:r.properties,refresh_interval:"60",title:e.properties.name},o),!r.permanent_tooltips&&t.setLabelNoHide&&t.setLabelNoHide(!1),r.popup_widget){var a=document.createElement("div"),s=JSON.parse(JSON.stringify(r.popup_widget)),p=s.name;delete s.name,s.service=r.service,s.offering=r.offering,new n(p).inspect(function(i,r,o){-1!=i.indexOf("feature")?s.feature=e.id:-1!=i.indexOf("features")&&(s.features=[e.id]),t.bindPopup(a,{minWidth:o[0].w,minHeight:o[0].h}),a.setAttribute("style","width:"+o[0].w+"px;height:"+o[0].h+"px;"),new n(p,s,a)})}}});m.fitBounds(o.getBounds(),{maxZoom:r.max_initial_zoom?parseInt(r.max_initial_zoom):14})}for(var s in i){var p=i[s];p.identifier==r.offering&&e.getFeatureOfInterest(p.procedure[0],o,a)}},a)}function p(e){return"[object Array]"===Object.prototype.toString.call(e)}function u(e,t){return t.indexOf(e)>-1}function d(e){for(var t=[],n=0;n<e.length;n++)p(e[n])?t[n]=d(e[n]):!n%2&&(t[n]=e[n+1],t[n+1]=e[n]);return t}function c(e){var t=p(r.features)?r.features:JSON.parse(r.features),n=[];for(var i in e){var o=e[i];if(o.geometry&&(!t.length||u(o.identifier.value,r.features))){r.swap_axis||(o.geometry.coordinates=d(o.geometry.coordinates));var a={type:"Feature",geometry:o.geometry,id:o.identifier.value,properties:{name:o.name?o.name.value:o.identifier.value}};n.push(a)}}var s={type:"FeatureCollection",features:n};return s}var f=document.createElement("div");f.className="map widget",o.appendChild(f),i.init(r,o);var l;if(r.base_layer){var g="string"==typeof r.base_layer||r.base_layer instanceof String?JSON.parse(r.base_layer):r.base_layer;l=g.type&&"WMS"===g.type.toUpperCase()?t.tileLayer.wms(g.url,g.options):t.tileLayer(g.url,g.options)}else l=t.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19});r.footnote&&(l.options.attribution+=" | <b>"+r.footnote+"</b>"),("string"==typeof r.popup_widget||r.popup_widget instanceof String)&&(r.popup_widget=JSON.parse(r.popup_widget));var m=t.map(f,{layers:[l]}).setView([0,0],2);e.setUrl(r.service),s()}}});